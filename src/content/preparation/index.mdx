import { Card, CardHeader, CardDescription, CardTitle, CardContent } from '@/components/ui/card';
import { FileTree, Callout } from 'nextra/components'
import Link from 'next/link';

# Introduction

In this section, we will introduce how to prepare data, mesh, model, parameters, and input files before SpecFWAT.

## Required Files and Directories
<br/>
<div className='grid grid-cols-2 sm:grid-cols-2 mx-auto w-full gap-4'>
  <Link href="/docs/preparation/data" className="block h-full">
    <Card className="hover:shadow-lg dark:hover:shadow-none dark:hover:ring-4 dark:hover:ring-slate-800 cursor-pointer h-full">
      <CardHeader className="text-left items-start ">
        **`fwat_data/`**
        <CardDescription >
        This directory contains the seismic data, which is used for the forward simulation and adjoint measurements.
        </CardDescription>
      </CardHeader>
    </Card>
  </Link>
  <Card >
    <CardHeader className="text-left items-start ">
      **`DATA/meshfem3D_files/`**
      <CardDescription >
        This directory contains the mesh files (Following Specfem3D format), which define the computational domain for the forward simulation.
      </CardDescription>
    </CardHeader>
  </Card>
  <Card >
    <CardHeader className="text-left items-start ">
      **`DATA/tomo_files/tomography_model.h5`**
      <CardDescription >
        This file contains the initial model parameters in HDF5 format, which is used for creating GLL mesh and defining the model databases for the forward simulation.
      </CardDescription>
    </CardHeader>
  </Card>
  <Link href="/docs/preparation/parameter" className="block h-full">
    <Card className="hover:shadow-lg dark:hover:shadow-none dark:hover:ring-4 dark:hover:ring-slate-800 cursor-pointer h-full">
      <CardHeader className="text-left items-start">
        **`DATA/fwat_params.yml`**
        <CardDescription >
          This file contains the parameters for the SpecFWAT workflow.
        </CardDescription>
      </CardHeader>
    </Card>
  </Link>
  <Link href="https://specfem3d.readthedocs.io/en/latest/04_creating_databases/" target="_blank" rel="noopener noreferrer" className="block h-full" >
    <Card className="hover:shadow-lg dark:hover:shadow-none dark:hover:ring-4 dark:hover:ring-slate-800 cursor-pointer h-full">
      <CardHeader className="text-left items-start ">
        **`DATA/Par_file`**
        <CardDescription >
          This file contains the parameters for the Specfem3D. See **Main parameter file `Par_file`** section in the [Specfem3D documentation](https://specfem3d.readthedocs.io/en/latest/04_creating_databases/) for more details.
        </CardDescription>
      </CardHeader>
    </Card>
  </Link>
  <Link href="/docs/preparation/src_rec" className="block h-full">
    <Card className="hover:shadow-lg dark:hover:shadow-none dark:hover:ring-4 dark:hover:ring-slate-800 cursor-pointer h-full">
      <CardHeader className="text-left items-start ">
        **`src_rec/`**
        <CardDescription >
          This directory contains the source and receiver files, which define the source and receiver locations and porperties.
        </CardDescription>
      </CardHeader>
    </Card>
  </Link>
</div>

## Glossary

The SpecFWAT has a few key terms that are used throughout the documentation. Some values of these keys are used as the command line arguments for the SpecFWAT executables and used to define suffixes of input and output files. The following is a list of the key terms and their meanings:

### 1. `simu_type`
  The `simu_type` is a key term that defines simulation type. It can take the following values:
  - `noise`
  - `tele`

<Callout>
  The `simu_type` will be used in following cases:
  - As a command line argument `-s` after the **`xfwat_mesh_databases`** and **`xfwat_fwd_measure_adj`**. 
  - For joint inversion, as a suffix to define the path of databases and sum of kernels .
    * The database path will be `{LOCAL_PATH}/{simu_type}`
    * The sum of kernels will be `output/SUM_KERNELS_{simu_type}`

  The `LOCAL_PATH` is the parameter defined in *Par_file*.
</Callout>

### 2. `dat_type`

  The `dat_type` is a key term that defines the data type for the source and receiver files. It can take the following values:
  
  ##### For `simu_type = noise`
    - `noise`: Ambient noise data

  ##### For `simu_type = tele`
    - `tele`: Teleseismic waveform
    - `rf`: Receiver function waveform
    - `telecc`: Teleseismic cross-convolution

<Callout>
  The `dat_type` will be used to define the suffix of source list file in `src_rec/` directory, such as `sources_noise.dat`, `sources_tele.dat`, `sources_rf.dat`, and `sources_telecc.dat`.

  For teleseismic FWAT, the `TELE_TYPE` in *fwat_params.yml* will be used to define the `dat_type` for the source list files. See [teleseismic parameters](../docs/preparation/parameter#adjoint-source-1) for more details.
</Callout>

### 3. `model`
  The `model` is a key term to define model name of each iteration in the inversion process. It is usually a string with the format `MXX`, where `XX` is two-bit integer number representing the iteration number. For example, `M00`, `M01`, ..., `M09`.

### 4. `event_name`
  The `event_name` is a key term to define the event name for each seismic event. It is usually a string with the format `event_XXX`, where `XXX` is a string of event identifier. For example, `event_001`, `event_KW.MX001`, `event_20210101_123456` etc.

## Project Structure

The `project` is a work directory organized based on Specfem3D. Thus, subdirectories of Specfem3D are inherited in SpecFWAT. Usually we conduct an inversion and execute all scripts and commands in this directory. New directories of input files `fwat_data` and `src_rec` are added to the SpecFWAT project. The following is a brief description of the directory structure of a project:

<FileTree>
  <FileTree.Folder name="project" defaultOpen>
    {/* DATA */}
    <FileTree.Folder name="DATA" >
      <FileTree.Folder name="meshfem3D_files">
        <FileTree.File name="Mesh_Par_file.$simu_type">
        </FileTree.File>
        <FileTree.File name="interface.dat">
        </FileTree.File>
        <FileTree.File name="topo.dat">
        </FileTree.File>
      </FileTree.Folder>
      <FileTree.Folder name="tomo_files">
        <FileTree.File name="tomography_model.h5">
        </FileTree.File>
      </FileTree.Folder>
      <FileTree.File name="fwat_params.yml">
      </FileTree.File>
      <FileTree.File name="Par_file">
      </FileTree.File>
    </FileTree.Folder>
  
    {/* fwat_data */}
    <FileTree.Folder name="fwat_data">
      <FileTree.Folder name="event_1">
        <FileTree.File name="net.sta.BXR.sac">
        </FileTree.File>
        <FileTree.File name="net.sta.BXZ.sac">
        </FileTree.File>
      </FileTree.Folder>
      <FileTree.Folder name="event_2">
        <FileTree.File name="net.sta.BXR.sac">
        </FileTree.File>
        <FileTree.File name="net.sta.BXZ.sac">
        </FileTree.File>
      </FileTree.Folder>
    </FileTree.Folder>
  
    {/* src_rec */}
    <FileTree.Folder name="src_rec">
      <FileTree.File name="sources_noise.dat">
      </FileTree.File>
      <FileTree.File name="sources_tele.dat">
      </FileTree.File>
      <FileTree.File name="FKmodel_event_1.dat">
      </FileTree.File>
      <FileTree.File name="FKmodel_event_2.dat">
      </FileTree.File>
      <FileTree.File name="FORCESOLUTION_event_3.dat">
      </FileTree.File>
      <FileTree.File name="FORCESOLUTION_event_4.dat">
      </FileTree.File>
      <FileTree.File name="STATIONS_event_1">
      </FileTree.File>
      <FileTree.File name="STATIONS_event_2">
      </FileTree.File>
      <FileTree.File name="STATIONS_event_3">
      </FileTree.File>
      <FileTree.File name="STATIONS_event_4">
      </FileTree.File>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>